<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>profile page</title>
    <link rel="stylesheet" href="/css/profile.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <!-- MDB -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
  </head>
  <body class="gradient-custom-2">
    <header>
      <div class="container-fluid">
        <!-- Navbar -->
        <nav
          class="navbar fixed-top navbar-expand-lg navbar-dark mt-1 mb-5 shadow p-2"
          style="background-color: #607d8b"
        >
          <!-- Container wrapper -->
          <div class="container-fluid">
            <!-- Navbar brand -->
            <a class="navbar-brand mx-5" href="/"><h3>ESHOP SPORT</h3></a>

            <!-- Toggle button -->
            <button
              class="navbar-toggler text-white"
              type="button"
              data-mdb-toggle="collapse"
              data-mdb-target="#navbarSupportedContent1"
              aria-controls="navbarSupportedContent1"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <i class="fas fa-bars"></i>
            </button>

            <!-- Collapsible wrapper -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent1">
              <ul class="navbar-nav mx-5 me-auto mb-2 mb-lg-0">
                <!-- Link -->
                <li class="nav-item acitve">
                  <a class="nav-link mx-2" href="/"><h5>HOME</h5></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mx-2" href="/shop"><h5>SHOP NOW</h5></a>
                </li>

                <li class="nav-item">
                  <a class="nav-link mx-2" href="/contactus"
                    ><H5>CONTACT US</H5></a
                  >
                </li>
              </ul>

              <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item ms-5 fs-3 text-light">
                  <a href="/wishlist" class="text-decoration-none text-light"
                    ><i class="ri-heart-line"></i
                  ></a>
                </li>
                <li class="nav-item mx-5 fs-3">
                  <a href="/cart" class="text-decoration-none text-light d-flex"
                    ><i class="ri-shopping-cart-fill"></i
                  ></a>
                </li>
                <li class="nav-item pt-1">
                  <div class="d-flex">
                    <% if (ifuser) { %>

                    <div class="dropdown">
                      <button
                        class="btn btn-secondary dropdown-toggle"
                        type="button"
                        id="dropdownMenuButton1"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                      >
                        <i class="ri-user-fill"></i>
                      </button>
                      <ul
                        class="dropdown-menu"
                        aria-labelledby="dropdownMenuButton1"
                      >
                        <li>
                          <a class="dropdown-item" href="#">mohammed </a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/profile">profile</a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/orders">orders</a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/logout"
                            ><button class="btn btn-dark">logout</button></a
                          >
                        </li>
                      </ul>
                    </div>

                    <% } else { %>

                    <a href="/login">
                      <button class="btn btn-dark d-flex">
                        <h5 class="mx-2">LOGIN</h5>
                        <i class="ri-login-box-line fs-5"></i></button
                    ></a>

                    <% } %>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <!-- Container wrapper -->
        </nav>
      </div>
    </header>
    <style>
      body {
        margin-top: 20px;
        color: #1a202c;
        text-align: left;
        background-color: #e2e8f0;
      }
      .main-body {
        padding: 15px;
      }
      .card {
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
      }

      .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 0 solid rgba(0, 0, 0, 0.125);
        border-radius: 0.25rem;
      }

      .card-body {
        flex: 1 1 auto;
        min-height: 1px;
        padding: 1rem;
      }

      .gutters-sm {
        margin-right: -8px;
        margin-left: -8px;
      }

      .gutters-sm > .col,
      .gutters-sm > [class*="col-"] {
        padding-right: 8px;
        padding-left: 8px;
      }
      .mb-3,
      .my-3 {
        margin-bottom: 1rem !important;
      }

      .bg-gray-300 {
        background-color: #e2e8f0;
      }
      .h-100 {
        height: 100% !important;
      }
      .shadow-none {
        box-shadow: none !important;
      }
    </style>

    <section class="h-100">
      <div class="container">
        <div class="main-body">
          <!-- Breadcrumb -->
          <nav aria-label="breadcrumb" class="main-breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="index.html">Home</a></li>
              <li class="breadcrumb-item">
                <a href="javascript:void(0)">User</a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                User Profile
              </li>
            </ol>
          </nav>
          <!-- /Breadcrumb -->

          <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <div
                    class="d-flex flex-column align-items-center text-center"
                  >
                    <img
                      src="https://bootdey.com/img/Content/avatar/avatar7.png"
                      alt="Admin"
                      class="rounded-circle"
                      width="150"
                    />
                    <div class="mt-3">
                      <h4><%-userinfo.name %></h4>
                      <p class="text-secondary mb-1"><%-userinfo.email %></p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card mt-3">
                <ul class="list-group list-group-flush">
                  <li
                    class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
                  >
                    <h6 class="mb-0">wallet</h6>
                    <span class="text-success">Rs.<%-userinfo.wallet %></span>
                  </li>
                  <li
                    class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
                  >
                    <h6 class="mb-0">Cart</h6>
                    <a href="/cart"
                      ><span class="text-success">Get Cart</span></a
                    >
                  </li>
                  <li
                    class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
                  >
                    <h6 class="mb-0">Wishlist</h6>
                    <a href="/wishlist"
                      ><span class="text-success">Get Wishlist</span></a
                    >
                  </li>
                  <li
                    class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
                  >
                    <h6 class="mb-0">Orders</h6>
                    <a href="/orders"
                      ><span class="text-success">Get Orders</span></a
                    >
                  </li>
                  <!-- <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                        <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook mr-2 icon-inline text-primary"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>Facebook</h6>
                        <span class="text-secondary">bootdey</span>
                      </li> -->
                </ul>
              </div>
            </div>
            <div class="col-md-8" id="OG">
              <div class="card mb-3">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Full Name</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      <%-userinfo.name %>
                    </div>
                  </div>
                  <hr />
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Email</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      <%-userinfo.email %>
                    </div>
                  </div>
                  <hr />
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Phone</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      <%-userinfo.phone %>
                    </div>
                  </div>
                  <hr />
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Mobile</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      <%-userinfo.mobile %>
                    </div>
                  </div>
                  <hr />

                  <hr />
                  <div class="row">
                    <div class="col-sm-12">
                      <button class="btn btn-info" onclick="editProfile()">
                        edit
                      </button>
                      <button
                        type="button"
                        class="btn btn-primary justify-content-end"
                        data-bs-toggle="modal"
                        data-bs-target="#exampleModal"
                      >
                        Add Address
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <h5>Manage Address</h5>
              <div class="row gutters-sm">
                <% userinfo.address.forEach(i=> { %>
                <div class="col-sm-6 mb-3" id="delete<%= i.id %>">
                  <div class="card h-100">
                    <div class="card-body">
                      <div class="d-flex justify-content-between">
                        <h6><%= i.name %></h6>
                        <div class="">
                          <button
                            class="btn"
                            onclick="editAddress('<%= i._id %>','<%= i.name %>','<%= i.mobile %>','<%= i.address %>','<%= i.city %>','<%= i.state %>','<%= i.pinCode %>')"
                          >
                            <i class="fa-solid fa-pen-to-square"></i>
                          </button>
                          <button
                            
                            class="btn"
                            onclick="return confirm(`Do you really want to remove this address ?`),deletefromaddress(`<%= i._id %>`)"
                          >
                            <i class="fa-solid fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      <h6>HouseName: <%= i.HouseName %></h6>
                      <h6>phone: <%= i.phonenumber %></h6>
                      <h6>place: <%= i.Place %></h6>
                      <h6>District: <%= i.District %></h6>
                      <h6>state: <%= i.state %></h6>
                      <h6>pincode: <%= i.pincode %></h6>
                    </div>
                  </div>
                </div>
                <% }) %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <footer
      class="text-center text-white mt-4"
      style="background-color: #607d8b"
    >
      <hr class="text-dark" />

      <div class="container" style="height: 50px">
        <!-- Section: Social media -->
        <section class="mb-3">
          <!-- Facebook -->
          <a
            class="btn-link btn-floating btn-lg text-white"
            href="#!"
            role="button"
            data-mdb-ripple-color="dark"
            ><i class="fab fa-facebook-f"></i
          ></a>

          <!-- Twitter -->
          <a
            class="btn-link btn-floating btn-lg text-white"
            href="#!"
            role="button"
            data-mdb-ripple-color="dark"
            ><i class="fab fa-twitter"></i
          ></a>

          <!-- Google -->
          <a
            class="btn-link btn-floating btn-lg text-white"
            href="#!"
            role="button"
            data-mdb-ripple-color="dark"
            ><i class="fab fa-google"></i
          ></a>

          <!-- Instagram -->
          <a
            class="btn-link btn-floating btn-lg text-white"
            href="#!"
            role="button"
            data-mdb-ripple-color="dark"
            ><i class="fab fa-instagram"></i
          ></a>

          <!-- YouTube -->
          <a
            class="btn-link btn-floating btn-lg text-white"
            href="#!"
            role="button"
            data-mdb-ripple-color="dark"
            ><i class="fab fa-youtube"></i
          ></a>
        </section>
      </div>

      <div
        class="text-center p-3"
        style="background-color: rgba(0, 0, 0, 0.2); color: #e0e0e0"
      >
        © 2022 Copyright:
        <a class="text-white" href="https://mdbootstrap.com/">eshopsport.com</a>
      </div>
    </footer>

    <!-- Modal -->

    <!-- modal2 -->

    <!-- Button trigger modal -->
    <!-- Button trigger modal -->

    <section>
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">
                Add Address
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form
                class="needs-validation"
                action="/addressprofile"
                method="post"
                role="form"
                id="addAddress"
                onsubmit="return submitform(event)"
              >
                <div id="error"></div>
                <div class="mb-3">
                  <label for="address" class="form-label">House Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="HouseName"
                    name="HouseName"
                    placeholder="1234 Main St"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="username" class="form-label">Phone number</label>
                  <input
                    type="number"
                    class="form-control"
                    pattern="[0-9]{10}"
                    minlength="10"
                    maxlength="10"
                    name="phonenumber"
                    id="phonenumber"
                    placeholder="Phone Number"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="country" class="form-label">place</label>
                  <input
                    type="text"
                    class="form-control"
                    name="Place"
                    placeholder="Place"
                    id="place"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="state" class="form-label">District</label>
                  <input
                    type="text"
                    class="form-control"
                    name="District"
                    placeholder="District"
                    id="District"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="state" class="form-label">State</label>
                  <input
                    type="text"
                    class="form-control"
                    name="state"
                    id="state"
                    placeholder="State"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="zip" class="form-label">Pincode</label>
                  <input
                    type="text"
                    class="form-control"
                    name="pincode"
                    id="zip"
                    placeholder="Pincode"
                    required
                  />
                </div>
                <div class="d-flex justify-content-center my-5">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button class="btn btn-primary" type="submit">
                    Add Address
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script>
      function deletefromaddress(data) {
        axios.get(`/deletefromaddress?id=${data}`).then((result)=>{

          console.log(result);
          if (result.data.success) {
            window.location.reload()
          }
        
        })
      }
      function editProfile() {
        document.getElementById("OG").innerHTML = `
        <div class="col-lg-8">
					<div class="card">
            <form action="/editProfile" method="post">
						<div class="card-body">
							<div class="row mb-3">
								<div class="col-sm-3">
									<h6 class="mb-0">Full Name</h6>
								</div>
								<div class="col-sm-9 text-secondary">
									<input type="text" name="Name" class="form-control" value="<%-userinfo.name%>">
								</div>
							</div>
							<div class="row mb-3">
								<div class="col-sm-3">
									<h6 class="mb-0">Email</h6>
								</div>
								<div class="col-sm-9 text-secondary">
									<input type="text" name="Email"class="form-control" value="<%-userinfo.email%>">
								</div>
							</div>
							<div class="row mb-3">
								<div class="col-sm-3">
									<h6 class="mb-0">Phone</h6>
								</div>
								<div class="col-sm-9 text-secondary">
									<input type="text"name="Phone" class="form-control" value="<%-userinfo.phone%>">
								</div>
							</div>
							<div class="row mb-3">
								<div class="col-sm-3">
									<h6 class="mb-0">Mobile</h6>
								</div>
								<div class="col-sm-9 text-secondary">
									<input type="text" name="Mobile" class="form-control" value="<%-userinfo.mobile%>">
								</div>
							</div>
						
							<div class="row">
								<div class="col-sm-3"></div>
								<div class="col-sm-9 text-secondary">
									<input type="submit" class="btn btn-primary px-4" value="Save Changes">
								</div>
							</div>
						</div>
          </form>
					</div>`;
      }
    </script>
    <script>
      const form = document.querySelector("#addAddress");
      const HouseName = form.querySelector("#HouseName");
      const phonenumber = form.querySelector("#phonenumber");
      const place = form.querySelector("#place");
      const District = form.querySelector("#District");
      const state = form.querySelector("#state");
      const pincode = form.querySelector("#zip");

      const errorElement = document.querySelector("#error");
      function hideErrorMessage() {
        errorElement.innerHTML = "";
      }
      function showErrorMessage(message) {
        errorElement.innerHTML = `<div class="alert alert-danger border border-warning w-80 d-flex justify-content-center fw-bold py-2 mx-4" role="alert" >${message}</div>`;
        setTimeout(() => {
          errorElement.innerHTML = `<div></div>`;
        }, 5000);
      }

      function submitform(data) {
        var startsWithSpace = /^\s/;
        var isNegativeNumber = /^-\d/;

        if (
          HouseName.value.match(startsWithSpace) ||
          phonenumber.value.match(startsWithSpace) ||
          place.value.match(startsWithSpace) ||
          District.value.match(startsWithSpace) ||
          state.value.match(startsWithSpace) ||
          pincode.value.match(startsWithSpace)
        ) {
          showErrorMessage("space is not allowed");
          return false;
        } else if (
          HouseName.value.match(isNegativeNumber) ||
          phonenumber.value.match(isNegativeNumber) ||
          place.value.match(isNegativeNumber) ||
          District.value.match(isNegativeNumber) ||
          state.value.match(isNegativeNumber) ||
          pincode.value.match(isNegativeNumber)
        ) {
          showErrorMessage("negative number is not allowed");
          return false;
        } else if (
          HouseName.value == 0 ||
          phonenumber.value == 0 ||
          place.value == 0 ||
          District.value == 0 ||
          state.value == 0 ||
          pincode.value == 0
        ) {
          showErrorMessage("0 is not allowed");
          return false;
        }
        var fields = [HouseName, place, District, state];
        var numberRegex = /\d/;

        for (var i = 0; i < fields.length; i++) {
          if (fields[i].value.match(numberRegex)) {
            showErrorMessage("Number is not allowed");
            return false;
          }
        }

        var specialCharRegex = /[@#$!%*?&]/;
        if (
          HouseName.value.match(specialCharRegex) ||
          phonenumber.value.match(specialCharRegex) ||
          place.value.match(specialCharRegex) ||
          District.value.match(specialCharRegex) ||
          state.value.match(specialCharRegex) ||
          pincode.value.match(specialCharRegex)
        ) {
          showErrorMessage("Special characters are not allowed");
          return false;
        } else {
          hideErrorMessage();
          return true;
        }
      }
    </script>
  </body>
</html>
