<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <!-- MDB -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <div class="container-fluid">
        <!-- Navbar -->
        <nav
          class="navbar fixed-top navbar-expand-lg navbar-dark mt-1 mb-5 shadow p-2"
          style="background-color: #607d8b"
        >
          <!-- Container wrapper -->
          <div class="container-fluid">
            <!-- Navbar brand -->
            <a class="navbar-brand mx-5" href="/"><h3>ESHOP SPORT</h3></a>

            <!-- Toggle button -->
            <button
              class="navbar-toggler text-white"
              type="button"
              data-mdb-toggle="collapse"
              data-mdb-target="#navbarSupportedContent1"
              aria-controls="navbarSupportedContent1"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <i class="fas fa-bars"></i>
            </button>

            <!-- Collapsible wrapper -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent1">
              <ul class="navbar-nav mx-5 me-auto mb-2 mb-lg-0">
                <!-- Link -->
                <li class="nav-item acitve">
                  <a class="nav-link mx-2" href="/"><h5>HOME</h5></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link mx-2" href="/shop"><h5>SHOP NOW</h5></a>
                </li>

                <li class="nav-item">
                  <a class="nav-link mx-2" href="/contactus"
                    ><H5>CONTACT US</H5></a
                  >
                </li>
              </ul>

              <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item ms-5 fs-3 text-light">
                  <a href="/wishlist" class="text-decoration-none text-light"
                    ><i class="ri-heart-line"></i
                  ></a>
                </li>
                <li class="nav-item mx-5 fs-3">
                  <a href="/cart" class="text-decoration-none text-light d-flex"
                    ><i class="ri-shopping-cart-fill"></i
                  ></a>
                </li>
                <li class="nav-item pt-1">
                  <div class="d-flex">
                    <% if (ifuser) { %>

                    <div class="dropdown">
                      <button
                        class="btn btn-secondary dropdown-toggle"
                        type="button"
                        id="dropdownMenuButton1"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                      >
                        <i class="ri-user-fill"></i>
                      </button>
                      <ul
                        class="dropdown-menu"
                        aria-labelledby="dropdownMenuButton1"
                      >
                        <li>
                          <a class="dropdown-item" href="#">mohammed </a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/profile">profile</a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/orders">orders</a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="/logout"
                            ><button class="btn btn-dark">logout</button></a
                          >
                        </li>
                      </ul>
                    </div>

                    <% } else { %>

                    <a href="/login">
                      <button class="btn btn-dark d-flex">
                        <h5 class="mx-2">LOGIN</h5>
                        <i class="ri-login-box-line fs-5"></i></button
                    ></a>

                    <% } %>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <!-- Container wrapper -->
        </nav>
      </div>
    </header>

    <div class="container pt-4">
      <form action="/checkout" method="post" id="payment">
        <div class="row" style="margin-top: 100px">
          <h1 class="d-flex justify-content-center mb-5">checkout</h1>
          <div class="col-md-4 order-md-2 mb-4">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-muted">Your cart</span>
              <span class="badge badge-secondary badge-pill"><%-count %></span>
            </h4>
            <label class="text-danger"><%- quantityerr%></label>
            <ul class="list-group mb-3 sticky-top">
              <% productsdetails.forEach((i) => { %>

              <li
                class="list-group-item d-flex justify-content-between lh-condensed"
              >
                <div>
                  <h6 class="my-0"><%-i.productName %></h6>
                  <small
                    class="text-muted"
                    id="price"
                    name="price"
                    value="<%-i.price %>"
                    >price:₹<%-i.price %></small
                  >
                  <br />
                  <small class="text-muted" id="quantity"
                    >quantity:<%-i.cartQuantity %></small
                  >
                  <br />
                  <small class="text-muted"><%-i.description %></small>
                </div>

                <span class="text-muted">Total:₹<%-i.productTotal%></span>
              </li>
              <% }) %>

              <li
                class="list-group-item d-flex justify-content-between bg-light"
              >
                <h6 class="text-success">Promo code</h6>
                <small id="promoCode"></small>
              </li>
              <li class="list-group-item d-flex justify-content-between">
                <span>Total </span>
<input hidden name="totalAmount" value="<%-productsdetails.sum %>">
                <strong value="<%-productsdetails.sum %>"
                  >₹<span id="totalprice"
                    ><%-productsdetails.sum %></span
                  ></strong
                >
              </li>
              <h4 class="my-3">Available Coupons</h4>
              <% coupons.forEach((i) => { %>

              <li
                class="list-group-item d-flex justify-content-between lh-condensed"
              >
                <div>
                  <h6 class="my-0">Coupon Name: <%-i.name %></h6>
                  <small>Code:<%-i.couponCode %></small>
                  <br />
                  <small class="text-muted" id="quantity"
                    >Dicount:₹<%-i.discount %></small
                  >
                  <br />
                  <small class="text-muted"
                    >Minimum purchase:₹<%-i.minamount %></small
                  >
                </div>
              </li>
              <% }) %>
              <li class="list-group-item d-flex justify-content-between">
                <div class="input-group mt-4">
                  <input
                    type="text"
                    placeholder="Promo code"
                    id="promo"
                    name="promo"
                    class="rounded"
                  />

                  <button
                    type="button"
                    onclick="promoCode()"
                    class="btn btn-secondary ms-2"
                    id="Redeemcode"
                    name="Redeemed"
                  >
                    Redeem
                  </button>
                </div>
              </li>
              <h4 class="my-3">wallet</h4>
              <li class="list-group-item d-flex justify-content-between">
                
                  <span>wallet amount  </span> <span>₹<%-userinfo.wallet %></span>
             

                </li>
            </ul>
          </div>

          <div class="col-md-8 order-md-1" id="exampleModalCenter">
            <h4 class="mb-3">Billing address</h4>
            <!-- Button trigger modal -->

            <button
              type="button"
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal"
            >
              add address
            </button>
            <label class="text-danger"><%-addressError %></label>

            <!-- Modal -->

            <% if (!userinfo.address[0]) { %>

           

            <h5 class="mt-5">Your Address</h5>
            <% } else { %> 
              <h5 class="mt-5">Your Address</h5>
              <% userinfo.address.forEach((i) => { %>
           
            <div class="d-flex radio border" id="deletefromaddress<%= i._id %>">
              <%= i.address %>
              <br />
              <%= i.country %>
              <br />
              <%= i.state %>
              <br />

              <input
                type="radio"
                id="address<%= i.id %>"
                name="address"
                value="<%= i._id %>"
                required
              />
              <button
                type="button"
                onclick=" deletefromaddress(`<%-i._id %>`,`del`)"
                class="btn btn-outline-none border-0"
              >
                <i
                  title="delete address"
                  class="ri-delete-bin-6-fill fs-4 text-danger"
                ></i>
              </button>
            </div>
            <% }) %> <% } %>

            <hr class="mb-4" />
            <h4 class="mb-3">Payment Options:</h4>
            <div class="d-block my-3">
              <div class="custom-control custom-radio">
                <input
                  id="credit"
                  name="paymentType"
                  type="radio"
                  class="custom-control-input"
                  value="online payment"
                  required
                />
                <label class="custom-control-label" for="credit"
                  >Online Payment</label
                >
              </div>
         
              <div class="custom-control custom-radio">
                <input
                id="cash"
                name="paymentType"
                type="radio"
                value="Cash On Delivery"
                required
                />
                <label class="custom-control-label" for="cash"
                >Cash on Delivery</label
                >
              </div>
              <div class="custom-control custom-radio">
                <input
                value="wallet"
                required
                  name="paymentType"
                  type="radio"
                  
                />
                <label class="custom-control-label" for="paypal">wallet </label>
                
              </div>
            </div>
        
          
            <hr class="mb-4" />
          </div>
        </div>
        <button
          class="btn btn-primary btn-lg btn-block form-control"
          id="payment"
          type="submit"
        >
          Payment
        </button>
      </form>
    </div>
    <footer
    class="text-center text-white mt-4"
    style="background-color: #607d8b"
  >
    <hr class="text-dark" />

    <div class="container" style="height: 50px">
      <!-- Section: Social media -->
      <section class="mb-3">
        <!-- Facebook -->
        <a
          class="btn-link btn-floating btn-lg text-white"
          href="#!"
          role="button"
          data-mdb-ripple-color="dark"
          ><i class="fab fa-facebook-f"></i
        ></a>

        <!-- Twitter -->
        <a
          class="btn-link btn-floating btn-lg text-white"
          href="#!"
          role="button"
          data-mdb-ripple-color="dark"
          ><i class="fab fa-twitter"></i
        ></a>

        <!-- Google -->
        <a
          class="btn-link btn-floating btn-lg text-white"
          href="#!"
          role="button"
          data-mdb-ripple-color="dark"
          ><i class="fab fa-google"></i
        ></a>

        <!-- Instagram -->
        <a
          class="btn-link btn-floating btn-lg text-white"
          href="#!"
          role="button"
          data-mdb-ripple-color="dark"
          ><i class="fab fa-instagram"></i
        ></a>

        <!-- YouTube -->
        <a
          class="btn-link btn-floating btn-lg text-white"
          href="#!"
          role="button"
          data-mdb-ripple-color="dark"
          ><i class="fab fa-youtube"></i
        ></a>
      </section>
   
    </div>

    <div
      class="text-center p-3"
      style="background-color: rgba(0, 0, 0, 0.2); color: #e0e0e0"
    >
      © 2022 Copyright:
      <a class="text-white" href="https://mdbootstrap.com/">eshopsport.com</a>
    </div>

  </footer>
    <section>
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">
                Add Address
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form class="needs-validation" action="/address" method="post">
                <div class="mb-3">
                  <label for="firstName" class="form-label">First name</label>
                  <input
                    type="text"
                    class="form-control"
                    name="firstName"
                    id="firstName"
                    placeholder=""
                    value=""
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="lastName" class="form-label">Last name</label>
                  <input
                    type="text"
                    class="form-control"
                    name="lastName"
                    id="lastName"
                    placeholder=""
                    value=""
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="username" class="form-label">Phone number</label>
                  <input
                    type="number"
                    class="form-control"
                    pattern="[0-9]*"
                    minlength="10"
                    maxlength="10"
                    name="phonenumber"
                    id="username"
                    placeholder="Phone Number"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="address" class="form-label">Address</label>
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    name="address"
                    placeholder="1234 Main St"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="country" class="form-label">Country</label>
                  <input
                    type="text"
                    class="form-control"
                    name="country"
                    placeholder="Country"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="state" class="form-label">State</label>
                  <input
                    type="text"
                    class="form-control"
                    name="state"
                    placeholder="State"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="zip" class="form-label">Pincode</label>
                  <input
                    type="text"
                    class="form-control"
                    name="pincode"
                    id="zip"
                    placeholder="Pincode"
                    required
                  />
                </div>
                <div class="d-flex justify-content-center my-5">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button class="btn btn-primary" type="submit">
                    Add Address
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function promoCode() {
        let promo = document.getElementById("promo").value;
        let totalprice = document.getElementById("totalprice").textContent;

        if (promo) {
          axios
            .get(`/promoCode?data=${promo}&price=${totalprice}`)
            .then((result) => {
              console.log(result);
              let newPrice;
              let total = result.data.code;

              if (!result.data.success) {
                const promoCodeEl = document.getElementById("promoCode");
                promoCodeEl.innerHTML = "invalid code";
                promoCodeEl.classList.add("text-danger");

                console.log("222222222222");
              } else {
                const promoCodeEl = document.getElementById("promoCode");

                promoCodeEl.innerHTML = -result.data.code;
                let currentPrice = 0;

                const tp = document.getElementById("totalprice");
                currentPrice = Number(tp.innerHTML.replace(/[^0-9]+/g, ""));
                newPrice = currentPrice - result.data.code;
                tp.innerHTML = newPrice;

                promoCodeEl.classList.remove("text-danger");

                promoCodeEl.classList.add("text-success");
              }
            });
        } else {
          console.log(err);
        }
      }

      function deletefromaddress(data) {
        axios.get("/deletefromaddress/" + data);
        console.log(data);
        document.getElementById("deletefromaddress" + data).innerHTML = "";
      }
    </script>
  </body>
</html>
